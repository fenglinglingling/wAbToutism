<!doctype html>
<html lang="en">
<head>
    <title>TourX - Tours and Travel HTML Template</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- wow css -->
    <link rel="stylesheet" href="../static/css/animate.css">
    <!-- magnific popup -->
    <link rel="stylesheet" href="../static/css/magnific-popup.css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <!-- Boxicons CSS -->
    <link rel="stylesheet" href="../static/css/boxicons.min.css">
    <!-- Icon Font CSS -->
    <link rel="stylesheet" href="../static/css/flaticon.css">
    <!-- Owl Carousel CSS -->
    <link rel="stylesheet" href="../static/css/owl.carousel.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/css/responsive.css">

</head>
<style>


    .bubble {
        max-width: 400px;
        padding: 10px;
        border-radius: 5px;
        position: relative;
        color: #000;
        word-wrap: break-word;
        word-break: normal;
    }

    .item-left .bubble {
        margin-left: 15px;
        background-color: #fff;
    }

    .item-left .bubble:before {
        content: "";
        position: absolute;
        width: 0;
        height: 0;
        border-left: 10px solid transparent;
        border-top: 10px solid transparent;
        border-right: 10px solid #fff;
        border-bottom: 10px solid transparent;
        left: -20px;
    }

    .item-right .bubble {
        margin-right: 15px;
        background-color: #9eea6a;
    }

    .item-right .bubble:before {
        content: "";
        position: absolute;
        width: 0;
        height: 0;
        border-left: 10px solid #9eea6a;
        border-top: 10px solid transparent;
        border-right: 10px solid transparent;
        border-bottom: 10px solid transparent;
        right: -20px;
    }

    .item {
        margin-top: 15px;
        display: flex;
        width: 100%;
    }

    .item.item-right {
        justify-content: flex-end;
    }

    .item.item-center {
        justify-content: center;
    }

    .item.item-center span {
        font-size: 12px;
        padding: 2px 4px;
        color: #fff;
        background-color: #dadada;
        border-radius: 3px;
        -moz-user-select: none; /*火狐*/
        -webkit-user-select: none; /*webkit浏览器*/
        -ms-user-select: none; /*IE10*/
        -khtml-user-select: none; /*早期浏览器*/
        user-select: none;
    }

    .avatar img {
        width: 42px;
        height: 42px;
        border-radius: 50%;
    }

    .input-area {
        border-top: 0.5px solid #e0e0e0;
        height: 150px;
        display: flex;
        flex-flow: column;
        background-color: #fff;
    }

    textarea {
        flex: 1;
        padding: 5px;
        font-size: 14px;
        border: none;
        cursor: pointer;
        overflow-y: auto;
        overflow-x: hidden;
        outline: none;
        resize: none;
    }

    .button-area {
        display: flex;
        height: 40px;
        margin-right: 10px;
        line-height: 40px;
        padding: 5px;
        justify-content: flex-end;
    }

    .button-area button {
        width: 80px;
        border: none;
        outline: none;
        border-radius: 4px;
        float: right;
        cursor: pointer;
    }

    /* 设置滚动条的样式 */
    ::-webkit-scrollbar {
        width: 10px;
    }

    /* 滚动槽 */
    ::-webkit-scrollbar-track {
        -webkit-box-shadow: inset006pxrgba(0, 0, 0, 0.3);
        border-radius: 8px;
    }

    /* 滚动条滑块 */
    ::-webkit-scrollbar-thumb {
        border-radius: 10px;
        background: rgba(0, 0, 0, 0);
        -webkit-box-shadow: inset006pxrgba(0, 0, 0, 0.5);
    }

</style>
<body>


<div class="breadcrumb-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="breadcrumb-wrap">
                    <h2>同城群聊</h2>
                    <ul class="breadcrumb-links">
                        <li>
                            群号：<a id="groupName"></a><br>
                            群主：<a id="groupUser"></a><br>
                            标签：<a id="groupType"></a><br>
                        </li>

                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="content liaoTianContent" style="background: #BBBBBB">
        <br>
    </div>
    <div class="input-area">
        <textarea name="text" id="textarea" style="background: #D0D3D4 "></textarea>

        <div class="button-area">
            <button id="send-btn" onclick="send()">发 送</button>
        </div>
    </div>
</div>

<div class="footer-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 col-md-12">
                <div class="footer-info">
                    <div class="footer-logo">
                        <img src="../static/picture/logo-2.png" alt="" class="img-fluid">
                    </div>
                    <p>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Aliquid maxime aut ut voluptate
                        dolorum nisi ducimus ratione</p>
                    <div class="footer-social-icons">
                        <h5>Follow Us:</h5>
                        <ul>
                            <li><a href="#"><i class='bx bxl-facebook'></i></a></li>
                            <li><a href="#"><i class='bx bxl-instagram'></i></a></li>
                            <li><a href="#"><i class='bx bxl-twitter'></i></a></li>
                            <li><a href="#"><i class='bx bxl-dribbble'></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-lg-8 col-md-12">
                <div class="row">
                    <div class="col-lg-5 col-md-5 col-sm-7">
                        <div class="footer-links">
                            <h5 class="widget-title">Contact us</h5>

                            <div class="contact-box">
                                <span><i class="bx bx-phone"></i></span>
                                <div>
                                    <a href="tel:+01852-1265122">+01852-1265122</a>
                                    <a href="tel:+01852-1265122">+01852-1265122</a>
                                </div>
                            </div>
                            <div class="contact-box">
                                <span><i class="bx bx-mail-send"></i></span>
                                <div>
                                    <a href="javascript:;"><span class="__cf_email__"
                                                                 data-cfemail="355c5b535a75504d54584559501b565a58">[email&#160;protected]</span></a>
                                    <a href="javascript:;"><span class="__cf_email__"
                                                                 data-cfemail="b6c5c3c6c6d9c4c2f6d3ced7dbc6dad398d5d9db">[email&#160;protected]</span></a>
                                </div>
                            </div>
                            <div class="contact-box">
                                <span><i class="bx bx-location-plus"></i></span>
                                <div>
                                    <a href="#">2752 Willison Street <br>
                                        Eagan, United State</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-5">
                        <div class="footer-links">
                            <h5 class="widget-title">support</h5>
                            <div class="category-list">
                                <ul>
                                    <li><a href="contact.html">Contact us</a></li>
                                    <li><a href="about.html">About us</a></li>
                                    <li><a href="#">Services</a></li>
                                    <li><a href="blog.html">our Blogs</a></li>
                                    <li><a href="#">terms and conditions</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4">
                        <div class="footer-links payment-links">
                            <h5 class="widget-title">We Accepts:</h5>
                            <div class="payment-cards">
                                <img src="../static/picture/payment-card-2.png" alt="" class="img-fluid">
                                <img src="../static/picture/payment-card-1.png" alt="" class="img-fluid">
                                <img src="../static/picture/payment-card-3.png" alt="" class="img-fluid">
                                <img src="../static/picture/payment-card-4.png" alt="" class="img-fluid">
                                <img src="../static/picture/payment-card-5.png" alt="" class="img-fluid">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="copyrigth-area">
                    <p>Copyright &copy; 2021.Company name All rights reserved.<a target="_blank">&#x7F51;&#x9875;&#x6A21;&#x677F;</a>
                    </p>
                </div>
            </div>
        </div>

    </div>
</div>


<!--Javascript -->
<script src="../static/js/jquery-3.6.0.min.js"></script>
<script src="../static/js/owl.carousel.min.js"></script>
<script src="../static/js/bootstrap.min.js"></script>
<script src="../static/js/jquery-ui.min.js"></script>
<script src="../static/js/popper.min.js"></script>
<script src="../static/js/jquery.magnific-popup.min.js"></script>
<script src="../static/js/wow.min.js"></script>
<script src="../static/js/typed.js"></script>
<!-- Custom JavaScript -->
<script src="../static/js/main.js"></script>
<script>

    $(function () {
        //加载历史消息
        $.ajax({
            url: "selectChatByGroupId",
            method: "get",
            dataType: "json",
            success(e) {
                console.log(e)

                let chats = e.chats
                for (let i = 0; i < chats.length; i++) {
                    //更加聊天的uderid来进行分辨，自己的聊天在右边，别人的在左边
                    if(chats[i].userId == e.userId){
                        $(".liaoTianContent").append(`
                              <div class="item item-right">
                                    <div class="bubble bubble-left">`+chats[i].content+`</div>
                                     <div class="avatar">
                                        <img src="../static/picture/payment-card-2.png"/>
                                    </div>
                              </div>
                              <br>
                        `)
                    }else {
                        $(".liaoTianContent").append(`
                              <div class="item item-left">
                                    <div class="avatar">
                                        <img src="../static/picture/payment-card-1.png"/>
                                    </div>
                                    <div class="bubble bubble-left">`+chats[i].content+`</div>
                              </div>
                              <br>
                        `)
                    }
                }
            },
            error() {
                alter("请求失败！")
            }
        })

        //加载群聊成员信息
        $.ajax({
            url:"selectChatGroup",
            method:"get",
            dataType:"json",
            success(e){
                console.log(e)
                //动态添加
                $("#groupId").html(e.chatgroup.groupName)
                $("#groupName").html(e.chatgroup.groupName)
                $("#groupUser").html(e.chatgroup.userId)
                $("#groupType").html(e.chatgroup.type)
            },
            error(){
                alter("请求失败！")
            }
        })
    });


    function send() {
        let text = document.querySelector('#textarea').value;
        if (!text) {
            alert('请输入内容');
            return;
        }
        let item = document.createElement('div');
        item.className = 'item item-right';
        item.innerHTML = `<div class="bubble bubble-left">${text}</div><div class="avatar"><img src="../static/picture/payment-card-2.png" /></div><br>`;
        document.querySelector('.content').appendChild(item);
        document.querySelector('#textarea').value = '';
        document.querySelector('#textarea').focus();
        //滚动条置底
        let height = document.querySelector('.content').scrollHeight;
        document.querySelector(".content").scrollTop = height;

        //添加进入数据库
        $.ajax({
            url:"addChat",
            method:"post",
            data:{
                "content":text,//时间何用户id都在后台进行赋值
            },
            dataType:"json",
            success(e){
                console.log(e.addChat_result)
            },
            error(){
                console.log("请求失败！")
            }
        })

    }

</script>
</body>
</html>